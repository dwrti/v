<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: sans-serif; }
        #video-wrapper { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        video, iframe { width: 100%; height: 100%; border: none; }
        /* Ø²Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ù„Ø£Ù† Ø§Ù„Ù…ØªØµÙØ­Ø§Øª ØªØ­Ø¬Ø¨ Ø§Ù„ØµÙˆØª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ */
        #unmute-shield {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); color: white;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 9999; cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="unmute-shield" onclick="this.style.display='none'">
        <span style="font-size: 50px;">ğŸ§</span>
        <p>Ø¥Ø¶ØºØ· Ù‡Ù†Ø§ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª ÙˆØ§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</p>
    </div>

    <div id="video-wrapper">
        <p style="color: #444;">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø¨Ø«...</p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAjTD-OJBUYewp5bqV0iVh4Rxp5zjBsU54",
            authDomain: "videos-5e336.firebaseapp.com",
            databaseURL: "https://videos-5e336-default-rtdb.firebaseio.com",
            projectId: "videos-5e336",
            storageBucket: "videos-5e336.firebasestorage.app",
            messagingSenderId: "300218651134",
            appId: "1:300218651134:web:4bd24df8e555e62828f0af"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const videoRef = ref(db, 'liveVideo');

        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø§Ù„Ù„Ø­Ø¸ÙŠ Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª
        onValue(videoRef, (snapshot) => {
            const data = snapshot.val();
            if (data && data.url) {
                renderLiveVideo(data.url, data.timestamp);
            }
        });

        function renderLiveVideo(url, ts) {
            const wrapper = document.getElementById('video-wrapper');
            
            // Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨
            if (url.includes('youtube.com') || url.includes('youtu.be')) {
                let id = url.includes('v=') ? url.split('v=')[1].split('&')[0] : url.split('/').pop();
                wrapper.innerHTML = `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1&mute=0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
            } 
            // Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© (MP4, MOV, etc.)
            else {
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù€ timestamp ÙƒÙ€ ID ÙŠØ¬Ø¨Ø± Ø§Ù„Ù…ØªØµÙØ­ Ø¹Ù„Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø´ØºÙ„ ÙÙˆØ±Ø§Ù‹
                wrapper.innerHTML = `
                    <video id="player_${ts}" controls autoplay playsinline style="width:100%; height:100%;">
                        <source src="${url}" type="video/mp4">
                        <source src="${url}" type="video/quicktime">
                    </video>`;
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ
                const v = document.querySelector('video');
                if(v) v.play().catch(e => console.log("Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"));
            }
        }
    </script>
</body>
</html>
