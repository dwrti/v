<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    <style>
        body { font-family: sans-serif; background: #000; color: white; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .header { padding: 10px; background: #111; text-align: center; font-size: 0.9rem; border-bottom: 1px solid #333; opacity: 0.7; }
        #playerContainer { flex-grow: 1; display: flex; align-items: center; justify-content: center; }
        video, iframe { width: 100%; height: 100%; border: none; object-fit: contain; }
        .loading { color: #555; font-style: italic; }
    </style>
</head>
<body>

<div class="header">ğŸ“¡ Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± - Ù…Ø²Ø§Ù…Ù†Ø© Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</div>
<div id="playerContainer">
    <div class="loading">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø§Ø¨Ø·...</div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAjTD-OJBUYewp5bqV0iVh4Rxp5zjBsU54",
        authDomain: "videos-5e336.firebaseapp.com",
        databaseURL: "https://videos-5e336-default-rtdb.firebaseio.com",
        projectId: "videos-5e336",
        storageBucket: "videos-5e336.firebasestorage.app",
        messagingSenderId: "300218651134",
        appId: "1:300218651134:web:4bd24df8e555e62828f0af"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const videoRef = ref(db, 'sharedVideo');

    onValue(videoRef, (snapshot) => {
        const data = snapshot.val();
        if (data && data.url) {
            const url = data.url.trim();
            const container = document.getElementById('playerContainer');

            // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠÙˆØªÙŠÙˆØ¨
            if (url.includes("youtube.com") || url.includes("youtu.be")) {
                let id = url.includes("v=") ? url.split("v=")[1].split("&")[0] : url.split("/").pop();
                container.innerHTML = `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
            } 
            // Ø£ÙŠ Ø±Ø§Ø¨Ø· Ø¢Ø®Ø± (Ø³ÙˆØ§Ø¡ Ø§Ù†ØªÙ‡Ù‰ Ø¨Ù€ mp4 Ø£Ùˆ Ù„Ø§) Ø³Ù†Ø¬Ø¨Ø±Ù‡ Ø¹Ù„Ù‰ Ø§Ù„ÙØªØ­ Ø¯Ø§Ø®Ù„ Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
            else {
                container.innerHTML = `
                    <video id="vPlayer" controls autoplay playsinline>
                        <source src="${url}" type="video/mp4">
                        <source src="${url}" type="video/webm">
                        <source src="${url}" type="application/x-mpegURL"> Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ù‡Ø°Ø§ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.
                    </video>`;
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ Ù„ØªØ¬Ø§ÙˆØ² Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­
                const v = document.getElementById('vPlayer');
                v.play().catch(() => {
                    console.log("Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙŠØ­ØªØ§Ø¬ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹");
                });
            }
        }
    });
</script>
</body>
</html>
