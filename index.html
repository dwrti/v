<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مشغل الفيديو المشترك</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding-top: 50px; background-color: #f4f4f9; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); width: 90%; max-width: 600px; text-align: center; margin-bottom: 20px; }
        input { width: 85%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 20px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #218838; }
        video { width: 100%; border-radius: 8px; background: #000; }
        #adminSection { display: none; margin-top: 20px; border-top: 1px solid #eee; pt: 20px; }
        .status { color: #666; font-size: 0.9em; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div class="card">
        <h2>البث المباشر</h2>
        <p class="status" id="connectionStatus">جاري الاتصال بالقاعدة...</p>
        <video id="myPlayer" controls autoplay>
            <source src="" type="video/mp4">
            متصفحك لا يدعم مشغل الفيديو.
        </video>
    </div>

    <div class="card">
        <div id="loginSection">
            <h3>إدارة الفيديو</h3>
            <input type="password" id="passwordInput" placeholder="أدخل كلمة السر للإضافة">
            <button onclick="checkPassword()">دخول</button>
        </div>

        <div id="adminSection">
            <p style="color: green;">مرحباً أيها المدير</p>
            <input type="text" id="videoUrl" placeholder="ضع رابط الفيديو المباشر هنا">
            <button onclick="updateVideoForAll()">تحديث الفيديو عند الجميع</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // إعداداتك التي أرفقتها سابقاً
        const firebaseConfig = {
            apiKey: "AIzaSyAjTD-OJBUYewp5bqV0iVh4Rxp5zjBsU54",
            authDomain: "videos-5e336.firebaseapp.com",
            databaseURL: "https://videos-5e336-default-rtdb.firebaseio.com",
            projectId: "videos-5e336",
            storageBucket: "videos-5e336.firebasestorage.app",
            messagingSenderId: "300218651134",
            appId: "1:300218651134:web:4bd24df8e555e62828f0af"
        };

        // تهيئة Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const videoRef = ref(db, 'sharedVideo');

        // --- وظيفة الاستقبال (للجميع) ---
        onValue(videoRef, (snapshot) => {
            const data = snapshot.val();
            if (data && data.url) {
                const video = document.getElementById('myPlayer');
                if (video.src !== data.url) {
                    video.src = data.url;
                    video.load();
                }
                document.getElementById('connectionStatus').innerText = "متصل - يتم العرض الآن";
            }
        });

        // --- وظيفة الإرسال (للمدير فقط) ---
        window.updateVideoForAll = function() {
            const newUrl = document.getElementById('videoUrl').value;
            if (newUrl) {
                set(videoRef, {
                    url: newUrl,
                    time: Date.now()
                }).then(() => alert("تم التحديث بنجاح!"));
            }
        };

        // --- التحقق من كلمة السر (محلي) ---
        window.checkPassword = function() {
            const pass = document.getElementById('passwordInput').value;
            if (pass === "1234") { // يمكنك تغيير كلمة السر هنا
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('adminSection').style.display = 'block';
            } else {
                alert("كلمة السر خاطئة!");
            }
        };
    </script>
</body>
</html>
