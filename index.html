<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>المستقبل الذكي | تشغيل IPTV الأكيد</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>

    <style>
        body, html { margin: 0; padding: 0; height: 100%; background: #000; overflow: hidden; }
        .video-js { width: 100% !important; height: 100% !important; }
        #waiting { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; text-align: center; font-family: sans-serif; z-index: 10;
        }
    </style>
</head>
<body>

    <div id="waiting">
        <h2>Web Cast Pro</h2>
        <p>بانتظار الرابط... (يدعم سبيستون والقنوات المحمية)</p>
    </div>

    <video id="my-video" class="video-js vjs-big-play-centered" controls preload="auto" crossorigin="anonymous"></video>

    <script>
        // إعدادات Firebase الخاصة بك
        const firebaseConfig = {
            apiKey: "AIzaSyAjTD-OJBUYewp5bqV0iVh4Rxp5zjBsU54",
            authDomain: "videos-5e336.firebaseapp.com",
            databaseURL: "https://videos-5e336-default-rtdb.firebaseio.com",
            projectId: "videos-5e336",
            appId: "1:300218651134:web:4bd24df8e555e62828f0af"
        };

        firebase.initializeApp(firebaseConfig);
        const player = videojs('my-video');

        // دالة سحرية لتجاوز حماية CORS
        function getProxyUrl(url) {
            // نستخدم بروكسي مفتوح المصدر لتخطي حماية سيرفرات البث
            return "https://cors-anywhere.herokuapp.com/" + url;
        }

        firebase.database().ref('videoSync').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data && data.url) {
                document.getElementById('waiting').style.display = 'none';
                
                let finalUrl = data.url;
                
                // تشغيل الرابط مباشرة مع محاولة تخطي القيود
                player.src({
                    src: finalUrl,
                    type: 'application/x-mpegURL'
                });

                player.ready(function() {
                    player.play().catch(function(error) {
                        console.log("التشغيل التلقائي محجوب، يرجى الضغط يدوياً");
                    });
                });
            }
        });
    </script>
</body>
</html>
