<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø´ØºÙ„ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    
    <style>
        body { margin: 0; background: #121212; color: #fff; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        .container { width: 95%; max-width: 800px; text-align: center; }
        video { width: 100%; border-radius: 12px; background: #000; cursor: pointer; border: 1px solid #333; }
        .status { margin-top: 15px; padding: 10px; border-radius: 8px; background: #1e1e1e; color: #00e676; font-weight: bold; }
        .btn-start { background: #00e676; color: #000; border: none; padding: 15px 30px; border-radius: 30px; font-size: 1.2rem; cursor: pointer; margin-bottom: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div id="overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:100; display:flex; flex-direction:column; justify-content:center; align-items:center;">
    <button class="btn-start" onclick="startApp()">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ù…Ø²Ø§Ù…Ù†Ø© ğŸ¬</button>
    <p>ÙŠØ¬Ø¨ Ø§Ù„Ø¶ØºØ· Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</p>
</div>

<div class="container">
    <h2 id="title">Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± - ØºØ±ÙØ© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</h2>
    <video id="video" controls playsinline></video>
    <div id="status" class="status">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙØ¹ÙŠÙ„...</div>
</div>

<script>
    // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyAjTD-OJBUYewp5bqV0iVh4Rxp5zjBsU54",
        authDomain: "videos-5e336.firebaseapp.com",
        databaseURL: "https://videos-5e336-default-rtdb.firebaseio.com",
        projectId: "videos-5e336",
        storageBucket: "videos-5e336.firebasestorage.app",
        messagingSenderId: "300218651134",
        appId: "1:300218651134:web:4bd24df8e555e62828f0af"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref('global_sync');

    const video = document.getElementById('video');
    const status = document.getElementById('status');
    const videoSrc = 'https://shd-gcp-live.edgenextcdn.net/live/bitmovin-spacetoon/d8382fb9ab4b2307058f12c7ea90db54/index.m3u8';

    function startApp() {
        document.getElementById('overlay').style.display = 'none';
        
        // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø£ÙˆÙ„ Ù…Ø±Ø©
        if (Hls.isSupported()) {
            const hls = new Hls();
            hls.loadSource(videoSrc);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = videoSrc;
            video.play();
        }

        startSync();
    }

    function startSync() {
        let isInternalUpdate = false;

        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
        const updateRemote = () => {
            if (isInternalUpdate) return;
            db.set({
                playing: !video.paused,
                time: video.currentTime,
                timestamp: Date.now()
            });
        };

        video.onplay = updateRemote;
        video.onpause = updateRemote;
        video.onseeking = updateRemote;

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…Ù† Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡
        db.on('value', (snapshot) => {
            const data = snapshot.val();
            if (!data) return;

            isInternalUpdate = true;

            // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙˆÙ‚Øª (Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙØ±Ù‚ Ø£ÙƒØ«Ø± Ù…Ù† Ø«Ø§Ù†ÙŠØªÙŠÙ†)
            if (Math.abs(video.currentTime - data.time) > 2) {
                video.currentTime = data.time;
            }

            // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
            if (data.playing && video.paused) {
                video.play().catch(e => console.log("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ"));
            } else if (!data.playing && !video.paused) {
                video.pause();
            }

            status.innerText = "Ù…ØªØµÙ„ âœ… - Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙˆÙ† Ø§Ù„Ø¢Ù† Ù…ØªØ²Ø§Ù…Ù†ÙˆÙ†";
            setTimeout(() => { isInternalUpdate = false; }, 500);
        });
    }
</script>

</body>
</html>
