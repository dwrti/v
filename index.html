<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Player</title>
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
    <style>
        body { font-family: sans-serif; background: #000; color: #fff; margin: 0; display: flex; height: 100vh; }
        #sidebar { width: 250px; background: #111; display: flex; flex-direction: column; border-left: 1px solid #333; }
        #search { padding: 10px; border: none; background: #222; color: #fff; margin: 10px; border-radius: 5px; }
        #list { flex: 1; overflow-y: auto; list-style: none; padding: 0; margin: 0; }
        #list li { padding: 10px; border-bottom: 1px solid #222; cursor: pointer; font-size: 13px; }
        #list li:hover { background: #333; }
        #player-container { flex: 1; position: relative; }
        .video-js { width: 100% !important; height: 100% !important; }
    </style>
</head>
<body>

<div id="sidebar">
    <input type="text" id="search" placeholder="بحث عن قناة...">
    <ul id="list"><li style="padding:20px;">جاري جلب القنوات...</li></ul>
</div>

<div id="player-container">
    <video id="vid" class="video-js vjs-default-skin" controls preload="auto"></video>
</div>

<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
<script>
    // الرابط المباشر الخاص بك
    const rawUrl = "http://easyip.xyz/get.php?username=sgD6wpYw&password=hUDaZru&type=m3u&output=ts";
    // استخدام بروكسي بديل لتجاوز حظر المتصفح
    const proxyUrl = "https://corsproxy.io/?" + encodeURIComponent(rawUrl);

    const player = videojs('vid');
    let channels = [];

    async function load() {
        try {
            const res = await fetch(proxyUrl);
            const text = await res.text();
            const lines = text.split('\n');
            const list = document.getElementById('list');
            list.innerHTML = '';

            for (let i = 0; i < lines.length; i++) {
                if (lines[i].includes('#EXTINF')) {
                    const name = lines[i].split(',')[1] || "Unknown";
                    const url = lines[i+1]?.trim();
                    if (url) {
                        channels.push({ name, url });
                        const li = document.createElement('li');
                        li.textContent = name;
                        li.onclick = () => {
                            player.src({ src: url, type: 'application/x-mpegURL' });
                            player.play();
                        };
                        list.appendChild(li);
                    }
                }
            }
        } catch (e) {
            document.getElementById('list').innerHTML = '<li style="color:red">فشل التحميل. جرب فتح الرابط من جهاز آخر أو تأكد من الاشتراك.</li>';
        }
    }

    document.getElementById('search').oninput = (e) => {
        const val = e.target.value.toLowerCase();
        const items = document.querySelectorAll('#list li');
        items.forEach(li => {
            li.style.display = li.textContent.toLowerCase().includes(val) ? '' : 'none';
        });
    };

    load();
</script>
</body>
</html>
