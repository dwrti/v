<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¬Ù…Ø§Ø¹ÙŠØ© Ù…ØªØ²Ø§Ù…Ù†Ø©</title>
    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    
    <style>
        body { margin: 0; background: #0b0e14; color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        .container { width: 90%; max-width: 850px; text-align: center; }
        video { width: 100%; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); background: #000; outline: none; }
        .status { margin-top: 15px; padding: 8px 15px; border-radius: 20px; background: #1a1d23; font-size: 0.9em; color: #00ffcc; border: 1px solid #333; }
        .controls-note { margin-top: 10px; color: #888; font-size: 0.8em; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“º Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¬Ù…Ø§Ø¹ÙŠØ©</h2>
    <video id="video" controls playsinline></video>
    <div id="status" class="status">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡...</div>
    <p class="controls-note">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø£ÙŠ ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø³ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¬Ù…ÙŠØ¹.</p>
</div>

<script>
    // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
    const firebaseConfig = {
      apiKey: "AIzaSyAjTD-OJBUYewp5bqV0iVh4Rxp5zjBsU54",
      authDomain: "videos-5e336.firebaseapp.com",
      databaseURL: "https://videos-5e336-default-rtdb.firebaseio.com",
      projectId: "videos-5e336",
      storageBucket: "videos-5e336.firebasestorage.app",
      messagingSenderId: "300218651134",
      appId: "1:300218651134:web:4bd24df8e555e62828f0af"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref('sync_player');

    const video = document.getElementById('video');
    const status = document.getElementById('status');
    const videoSrc = 'https://shd-gcp-live.edgenextcdn.net/live/bitmovin-spacetoon/d8382fb9ab4b2307058f12c7ea90db54/index.m3u8?aws.manifestfilter=video_height:144-720;video_codec:H264&video_height=144-720&video_codec=H264';

    // 2. ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø«
    if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(videoSrc);
        hls.attachMedia(video);
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = videoSrc;
    }

    // 3. Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„Ù„Ø§Ù†Ù‡Ø§Ø¦ÙŠ
    let isUpdating = false;

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±
    video.onplay = () => { if(!isUpdating) db.update({ playing: true, time: video.currentTime }); };
    video.onpause = () => { if(!isUpdating) db.update({ playing: false, time: video.currentTime }); };
    video.onseeking = () => { if(!isUpdating) db.update({ time: video.currentTime }); };

    // 4. Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡
    db.on('value', (snapshot) => {
        const data = snapshot.val();
        if (!data) return;

        isUpdating = true; // ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„ØªØ¬Ù†Ø¨ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø¯ ÙØ¹Ù„ Ø¯Ø§Ø¦Ø±ÙŠ

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙˆÙ‚Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙØ±Ù‚ Ø£ÙƒØ«Ø± Ù…Ù† Ø«Ø§Ù†ÙŠØ©
        if (Math.abs(video.currentTime - data.time) > 1.5) {
            video.currentTime = data.time;
        }

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ ÙˆØ§Ù„ØªÙˆÙ‚Ù
        if (data.playing && video.paused) {
            video.play().catch(() => {
                status.innerText = "Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´ØºÙ„ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª ÙˆØ§Ù„Ù…Ø²Ø§Ù…Ù†Ø©";
            });
        } else if (!data.playing && !video.paused) {
            video.pause();
        }

        status.innerText = "Ù…ØªØµÙ„ - Ù…Ø²Ø§Ù…Ù†Ø© Ù†Ø´Ø·Ø© Ù…Ø¹ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ âœ…";
        
        setTimeout(() => { isUpdating = false; }, 500);
    });

</script>

</body>
</html>
